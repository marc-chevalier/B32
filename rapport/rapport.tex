\input{src/macros.tex}

\title{Cryptanalyse linéaire}
\author{
    William \textsc{Aufort}\\
    Marc \textsc{Chevalier}
}
\date{\today}

\begin{document}
\maketitle

\section*{Question 2}

Notre programme nous donne la matrice $L$ suivante :

\setcounter{MaxMatrixCols}{16}
\[ L = \quad \begin{pmatrix}
16 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 \\
8 & 10 & 8 & 6 & 8 & 14 & 8 & 10 & 10 & 8 & 6 & 8 & 6 & 8 & 10 & 8 \\
8 & 4 & 8 & 8 & 6 & 10 & 6 & 6 & 8 & 8 & 4 & 8 & 10 & 10 & 6 & 10 \\
8 & 6 & 8 & 6 & 6 & 8 & 6 & 8 & 10 & 8 & 10 & 8 & 8 & 10 & 8 & 2 \\
8 & 10 & 8 & 10 & 8 & 6 & 8 & 6 & 14 & 8 & 6 & 8 & 10 & 8 & 10 & 8 \\
8 & 8 & 4 & 8 & 8 & 8 & 12 & 8 & 8 & 12 & 8 & 8 & 8 & 12 & 8 & 8 \\
8 & 10 & 4 & 10 & 10 & 8 & 6 & 8 & 6 & 4 & 6 & 8 & 8 & 10 & 8 & 6 \\
8 & 8 & 8 & 8 & 10 & 10 & 10 & 2 & 8 & 8 & 8 & 8 & 6 & 6 & 6 & 6 \\
8 & 4 & 6 & 6 & 10 & 6 & 8 & 8 & 8 & 8 & 6 & 10 & 6 & 6 & 12 & 8 \\
8 & 10 & 6 & 8 & 2 & 8 & 8 & 6 & 6 & 8 & 8 & 10 & 8 & 6 & 10 & 8 \\
8 & 8 & 10 & 10 & 8 & 8 & 10 & 10 & 8 & 8 & 6 & 14 & 8 & 8 & 6 & 6 \\
8 & 6 & 10 & 12 & 8 & 10 & 10 & 8 & 6 & 8 & 8 & 6 & 10 & 8 & 12 & 6 \\
8 & 6 & 6 & 8 & 6 & 8 & 12 & 10 & 10 & 4 & 8 & 6 & 8 & 6 & 6 & 8 \\
8 & 8 & 10 & 10 & 6 & 6 & 8 & 8 & 8 & 8 & 6 & 6 & 2 & 10 & 8 & 8 \\
8 & 6 & 6 & 12 & 8 & 10 & 6 & 8 & 10 & 8 & 12 & 10 & 6 & 8 & 8 & 10 \\
8 & 8 & 10 & 6 & 8 & 8 & 10 & 6 & 8 & 4 & 10 & 10 & 8 & 12 & 10 & 10

\end{pmatrix}\]

\section*{Question 3}

Les probabilités les plus éloignées de 0.5 (hormis 0) sont 0.125 et 0.875.
Elles sont atteintes respectivement pour les couples :
\begin{enumerate}
\item $p_{3,15} = p_{7,7} = p_{9,4} = p_{13,12} = 0.125$
\item $p_{1,5} = p_{4,8} = p_{10,11} = 0.875$
\end{enumerate}

L'idée générale sera d'utiliser ces valeurs pour trouver une relation entre des bits de l'entrée, des bits de la sortie, et des bits des clés $K_0, K_1 et K_2$ qui aura une forte probabilité de se réaliser. Ces relations doivent être suffisamment exploitables. Par exemple :
\begin{itemize}
	\item le couple $(1,5)$ nous dit que $x_0 = S(x)_0 \oplus S(x)_2$ avec probabilité 0.875, ici l'expression est satisfaisant car on exprime un seul bit de l'input en fonction de bits d'output.
	\item le couple $(9,4)$ nous dit que $x_0 \oplus x_3 =  S(x)_3$ avec probabilité 0.125, expression également satisfaisante car on exprime un seul bit de l'output en fonction de bits d'input.
	\item le couple $(10,11)$ nous dit que $x_1 \oplus x_3 = S(x)_0 + S(x)_1 + S(x)_3$ avec probabilité 0.875, cette dépendance est plus difficile à utiliser, même si elle apparaît avec une probabilité importante.
\end{itemize}

%Sachant que l'on cherche à approximer la fonction de chiffrement par la fonction linéaire, on souhaite avoir une probabilité de ressemblance importante, les couples $(a,b)$ tels que $p_{a,b} = 0.875$ sont donc les plus utiles pour la cryptanalyse linéaire.

\section*{Question 4}

\underline{Remarque :} Comme la fin de la question le laisse suggérer, on suppose que les probabilités portent sur le message $m$, et que les clés $K_0$, $K_1$ et $K_2$ sont fixées.

Soit $m$ un message aléatoire distribué (en tant que variable aléatoire) uniformément sur %TODO

Avec les notations introduites dans l'énoncé, on a $A.m = a.m^{(0)}$ et $P(B).x_1 = P(B).F(x_0,K_1) = P(B).(P(S(x_0)\oplus K_1)$.

Soit $K_3$ telle que $K_1 = P(K_3)$. On a :

$P(B).x_1 = P(B).(P(S(x_0))\oplus P(K_3)) = P(B).P(S(x_0) \oplus K_3) = B.(S(x_0) \oplus K_3) = b.(S(x_0^{(0)}) \oplus K_3^{(0)})$.

D'où $\prob{A.m = P(B).x_1} = \prob{a.m^{(0)}= b.(S(x_0^{(0)}) \oplus K_3^{(0)})}$.

Avec $x_0^{(0)} = m^{(0)} \oplus K_0^{(0)}$.

Pour se ramener aux probabilités introduites dans la matrice $L$ (i.e du type $\prob{a.y = b.S(y)}$), l'idée est d'observer que l'utilisation des clés ne changent pas la distribution uniforme.

\begin{lemma}
	Si $x$ est uniforme, alors $x \oplus K$ est uniforme pour tout clé $K$.
\end{lemma}

\begin{proof}
	Il suffit de montrer que chaque bit de $x \oplus K$ est uniformément distribué dans $\{0,1\}$.

	Soit $x_i$ un bit aléatoire de $x$. Le ième bit de $x \oplus K$ est $x_i \oplus K_i$.

	Si $K_i = 0$, $x_i \oplus K_i = x_i$ donc uniforme.

	Si $K_i = 1$, $x_i \oplus K_i = 1 - x_i$ également uniforme. 
\end{proof}

\begin{lemma}
	Si $x$ est uniforme, alors $S(x)$ et $P(x)$ aussi.
\end{lemma}
\begin{proof}
	Clair car $S$ et $P$ sont des bijections.
\end{proof}

Avec ces deux lemmes, on peut maintenant écrire :

\begin{align*}
\prob{a.m^{(0)}= b.(S(x_0^{(0)}) \oplus K_3^{(0)})} &= \prob{a.m^{(0)} = b.(S(x_0^{(0)}))} \\
													&= \prob{a.(x^{(0)} \oplus K_0^{(0)}) =  b.(S(x_0^{(0)}))} \\
													&= \prob{a.x^{(0)} = b.(S(x_0^{(0)}))} \\
													&= \frac{1}{2} \pm \frac{6}{16}
\end{align*}
Car $0.125 = \frac{1}{2} - \frac{6}{16}$ et $0.875 = \frac{1}{2} + \frac{6}{16}$.

D'où $\prob{A.m = P(B).x_1} = \frac{1}{2} \pm \frac{6}{16}$, ce qui permet de conclure.

\section*{Question 5}

On numérote les S-Boxes $S_{1,1}, \dots S_{1,8}$ (premier round), $S_{2,1}, \dots S_{2,8}$ (deuxième round).

En modifiant les 4 premiers bits de l'entrée, on modifie la sortie de $S_{1,1}$, qui modifie (après permutation) l'entrée de $S_{2,1}$ et $S_{2,2}$ uniquement.
De la même manière, ces boxes $S_{2,1}$ et $S_{2,2}$ ne modifient que les 16 premiers bits de l'output.

Ainsi, dans cette première étape, on ne s'intéresse qu'à trouver les 16 premiers bits de la clé $K_2$.

% TODO : faire une figure comme dans le papier, page 13, après confirmation de Vincent Mercredi.

\section*{Question 6}



\end{document}

