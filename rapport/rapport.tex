\input{src/macros.tex}

\title{Cryptanalyse linéaire}
\author{
    William \textsc{Aufort}\\
    Marc \textsc{Chevalier}
}
\date{\today}

\begin{document}
\maketitle

\section*{Question 2}

Notre programme nous donne la matrice $L$ suivante :

\setcounter{MaxMatrixCols}{16}
\[ L = \quad \begin{pmatrix}
16 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 & 8 \\
8 & 10 & 8 & 6 & 8 & 14 & 8 & 10 & 10 & 8 & 6 & 8 & 6 & 8 & 10 & 8 \\
8 & 4 & 8 & 8 & 6 & 10 & 6 & 6 & 8 & 8 & 4 & 8 & 10 & 10 & 6 & 10 \\
8 & 6 & 8 & 6 & 6 & 8 & 6 & 8 & 10 & 8 & 10 & 8 & 8 & 10 & 8 & 2 \\
8 & 10 & 8 & 10 & 8 & 6 & 8 & 6 & 14 & 8 & 6 & 8 & 10 & 8 & 10 & 8 \\
8 & 8 & 4 & 8 & 8 & 8 & 12 & 8 & 8 & 12 & 8 & 8 & 8 & 12 & 8 & 8 \\
8 & 10 & 4 & 10 & 10 & 8 & 6 & 8 & 6 & 4 & 6 & 8 & 8 & 10 & 8 & 6 \\
8 & 8 & 8 & 8 & 10 & 10 & 10 & 2 & 8 & 8 & 8 & 8 & 6 & 6 & 6 & 6 \\
8 & 4 & 6 & 6 & 10 & 6 & 8 & 8 & 8 & 8 & 6 & 10 & 6 & 6 & 12 & 8 \\
8 & 10 & 6 & 8 & 2 & 8 & 8 & 6 & 6 & 8 & 8 & 10 & 8 & 6 & 10 & 8 \\
8 & 8 & 10 & 10 & 8 & 8 & 10 & 10 & 8 & 8 & 6 & 14 & 8 & 8 & 6 & 6 \\
8 & 6 & 10 & 12 & 8 & 10 & 10 & 8 & 6 & 8 & 8 & 6 & 10 & 8 & 12 & 6 \\
8 & 6 & 6 & 8 & 6 & 8 & 12 & 10 & 10 & 4 & 8 & 6 & 8 & 6 & 6 & 8 \\
8 & 8 & 10 & 10 & 6 & 6 & 8 & 8 & 8 & 8 & 6 & 6 & 2 & 10 & 8 & 8 \\
8 & 6 & 6 & 12 & 8 & 10 & 6 & 8 & 10 & 8 & 12 & 10 & 6 & 8 & 8 & 10 \\
8 & 8 & 10 & 6 & 8 & 8 & 10 & 6 & 8 & 4 & 10 & 10 & 8 & 12 & 10 & 10

\end{pmatrix}\]

\section*{Question 3}

Les probabilités les plus éloignées de 0.5 (hormis 1) sont 0.125 et 0.875.
Elles sont atteintes respectivement pour les couples :
\begin{enumerate}
\item $p_{3,15} = p_{7,7} = p_{9,4} = p_{13,12} = 0.125$
\item $p_{1,5} = p_{4,8} = p_{10,11} = 0.875$
\end{enumerate}

En effet, il n'est pas très intéressant de travailler avec le couple $(0,0)$, car dans ce cas $a.x = b.S(x) \Leftrightarrow 0 = 0$, ce qui n'est pas très expressif comme relation...

\section*{Question 4}

\underline{Remarque :} Comme la fin de la question le laisse suggérer, on suppose que les probabilités portent sur le message $m$, et que les clés $K_0$, $K_1$ et $K_2$ sont fixées.

Soit $m$ un message aléatoire distribué (en tant que variable aléatoire) uniformément sur %TODO

Avec les notations introduites dans l'énoncé, on a \[A.m = a.m^{(0)}\] et \[P(B).x_1 = P(B).F(x_0,K_1) = P(B).(P(S(x_0)\oplus K_1)\]

Soit $K_3$ telle que $K_1 = P(K_3)$. On a :


\[
    \begin{aligned}
        P(B).x_1 &= P(B).\left (P\left (S\left (x_0\right )\right )\oplus P(K_3)\right ) \\
        &= P\left (B\right ).P\left (S\left (x_0\right ) \oplus K_3\right )\\
        &= B.\left (S\left (x_0\right ) \oplus K_3\right ) \\
        &= b.\left (S\left (x_0^{\left (0\right )}\right ) \oplus K_3^{(0)}\right )
    \end{aligned}
\]

D'où $\prob{A.m = P(B).x_1} = \prob{a.m^{(0)}= b.(S(x_0^{(0)}) \oplus K_3^{(0)})}$.

Avec $x_0^{(0)} = m^{(0)} \oplus K_0^{(0)}$.

Pour se ramener aux probabilités introduites dans la matrice $L$ (i.e du type $\prob{a.y = b.S(y)}$), l'idée est d'observer que l'utilisation des clés ne changent pas la distribution uniforme.

\begin{lemma}
	Si $x$ est uniforme, alors $x \oplus K$ est uniforme pour tout clé $K$.
\end{lemma}

\begin{proof}
	Il suffit de montrer que chaque bit de $x \oplus K$ est uniformément distribué dans $\{0,1\}$.

	Soit $x_i$ un bit aléatoire de $x$. Le ième bit de $x \oplus K$ est $x_i \oplus K_i$.

	Si $K_i = 0$, $x_i \oplus K_i = x_i$ donc uniforme.

	Si $K_i = 1$, $x_i \oplus K_i = 1 - x_i$ également uniforme. 
\end{proof}

\begin{lemma}
	Si $x$ est uniforme, alors $S(x)$ et $P(x)$ aussi.
\end{lemma}
\begin{proof}
	Clair car $S$ et $P$ sont des bijections.
\end{proof}

Avec ces deux lemmes, on peut maintenant écrire :

\begin{align*}
\prob{a.m^{(0)}= b.\left (S\left (x_0^{(0)}\right ) \oplus K_3^{(0)}\right )} &= \prob{a.m^{(0)} = b.(S(x_0^{(0)}))} \\
													&= \prob{a.\left(x^{(0)} \oplus K_0^{(0)}\right ) =  b.\left (S\left (x_0^{(0)}\right )\right )} \\
													&= \prob{a.x^{(0)} = b.\left(S\left(x_0^{\left(0\right)}\right)\right)} \\
													&= \frac{1}{2} \pm \frac{6}{16}
\end{align*}
Car $0.125 = \frac{1}{2} - \frac{6}{16}$ et $0.875 = \frac{1}{2} + \frac{6}{16}$.

D'où $\prob{A.m = P(B).x_1} = \frac{1}{2} \pm \frac{6}{16}$, ce qui permet de conclure.

\section*{Question 5}

Selon la valeur de $b$, les bits non nuls de $P(B)$ peuvent correspondre à une ou deux Sboxes (le "ou" ayant un sens exclusif ici). C'est ce qu'on entend par les cas "une active box" et "deux active boxes".

Dans le cas "une active box", on peut se limiter à chercher les 4 premiers bits de la clé, car les autres bits n'interviendront pas ( car $0.x = 0$ pour tout x). De la même manière, dans le cas de "deux actives boxes", on peut se limiter à chercher les 8 premiers bits de la clé.

L'algorithme, pour le cas "une active box", qui renvoit les 4 bits les plus probables pour la sous-clé qui nous intéresse est donné ci-dessous.

\begin{algorithm}
\caption{L'attaque des 4 bits de la clé pouvant être devinés, dans le cas "une active box"}
	\Entree{Des couples $(m,c)$}
	\Sortie{La sous-clé $K'_2$ la plus probable}
	\Pour{chaque couple $(a,b)$ de type "one active box"}
	{
		\Pour{chaque clé $K'_2 \in \{0,1\}^4$}
		{
			Calculer $x_1 = c \oplus K_2$ ($K_2$ = $K'_2$ complétée par des zéros ailleurs) \\
			\Si{$A.m = P(B).x_1$}{$Count[K'_2]$++}
		}
		$Guess(a,b) = Argmin \left( Count[.] \right)$
	}
	\Pour{chaque bit $i$ de la sous-clé à deviner}
	{
		Choisir $b$ tel que $b$ apparaît le plus souvent en ième position dans les $Guess(.,.)$.
	}
\end{algorithm}

\section*{Question 6}



\end{document}

